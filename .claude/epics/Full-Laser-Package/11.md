---
name: Laser Calculator
epic: Full-Laser-Package
status: backlog
priority: medium
size: L
created: 2025-09-16T03:01:25Z
updated: 2025-09-16T03:13:23Z
assignee: unassigned
parallel: true
depends_on: [5]
---

# Task: Laser Calculator

## Overview

Develop a comprehensive laser engraving calculator system that provides material-specific cutting parameters, depth calculations, and optimization recommendations. This calculator will serve as the technical brain for ensuring accurate and efficient laser operations across different materials and project requirements.

## Background

Laser cutting requires precise parameter tuning based on material properties, thickness, and desired outcomes. Manual parameter selection often leads to suboptimal results, wasted materials, and inconsistent quality. This calculator will provide data-driven recommendations based on a comprehensive material database and proven cutting algorithms.

## Technical Scope

### Material Database System
- **Material Properties Database**: SQLite database storing cutting parameters for wood, acrylic, metal, fabric, and specialty materials
- **Thickness Calibration**: Support for material thickness ranges from 0.5mm to 25mm with interpolation algorithms
- **Surface Finish Tracking**: Parameters for different finish requirements (smooth edge, speed optimization, detail preservation)
- **Custom Material Profiles**: User ability to add and calibrate custom materials with testing workflows

### Calculation Engines
- **Power/Speed Calculator**: Algorithm-based power and speed recommendations using material density, thickness, and laser specifications
- **Multi-Pass Optimization**: Intelligent multi-pass calculations for thick materials with heat management considerations
- **Kerf Compensation**: Automatic kerf width calculation and joint adjustment based on material and laser characteristics
- **Depth Control System**: Precise engraving depth calculations for variable-depth projects and layered designs

### Parameter Optimization
- **Feed Rate Optimization**: Dynamic feed rate calculations balancing speed and quality based on path complexity
- **Heat Management**: Cooling time calculations and sequential cutting order optimization to prevent warping
- **Quality Prediction**: Cut quality scoring system predicting edge finish and accuracy based on parameter combinations
- **Cost Analysis**: Material waste calculation and time estimation for project cost optimization

## Implementation Details

### Backend Architecture
```python
# Core calculation engine structure
class MaterialDatabase:
    - load_material_profiles()
    - interpolate_parameters()
    - validate_material_data()
    - export_custom_profile()

class LaserCalculator:
    - calculate_cutting_parameters()
    - optimize_multi_pass()
    - predict_cut_quality()
    - estimate_cutting_time()

class KerfCompensator:
    - measure_kerf_width()
    - adjust_path_dimensions()
    - compensate_joint_tolerances()
```

### Frontend Components
```typescript
// React components for calculator interface
interface CalculatorWidget {
  MaterialSelector: Component // Material type and thickness selection
  ParameterDisplay: Component // Real-time parameter recommendations
  QualityPredictor: Component // Visual quality and time predictions
  CalibrationTools: Component // Material testing and calibration interface
}
```

### Database Schema
```sql
-- Material database structure
CREATE TABLE materials (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    category TEXT NOT NULL,
    density REAL,
    melting_point REAL,
    thermal_conductivity REAL
);

CREATE TABLE cutting_parameters (
    material_id INTEGER,
    thickness_min REAL,
    thickness_max REAL,
    power_percent REAL,
    speed_mmmin REAL,
    passes INTEGER,
    kerf_width REAL,
    FOREIGN KEY (material_id) REFERENCES materials(id)
);
```

## API Endpoints

### Material Management
- `GET /api/materials/` - Retrieve available materials and categories
- `GET /api/materials/{id}/parameters` - Get cutting parameters for specific material and thickness
- `POST /api/materials/custom` - Add custom material profile with calibration data
- `PUT /api/materials/{id}/calibrate` - Update material parameters based on test results

### Calculation Services
- `POST /api/calculate/cutting` - Calculate optimal cutting parameters for material and thickness
- `POST /api/calculate/engraving` - Calculate engraving depth and power settings
- `POST /api/calculate/kerf` - Calculate kerf compensation for joint dimensions
- `GET /api/calculate/quality` - Predict cut quality and completion time

### Optimization Tools
- `POST /api/optimize/multipass` - Optimize multi-pass cutting strategy
- `POST /api/optimize/sequence` - Optimize cutting order for heat management
- `GET /api/optimize/cost` - Calculate material usage and time cost estimates

## Acceptance Criteria

### Core Functionality
- [ ] Material database with 20+ common materials and their cutting parameters
- [ ] Thickness interpolation working for any value between material limits
- [ ] Real-time parameter calculation responding within 200ms
- [ ] Kerf compensation adjusting box joint dimensions automatically
- [ ] Multi-pass optimization for materials >10mm thickness

### Accuracy Requirements
- [ ] Parameter recommendations within 5% of optimal values for tested materials
- [ ] Time estimates accurate within 10% for standard cutting operations
- [ ] Kerf compensation producing joints with <0.2mm tolerance variation
- [ ] Quality predictions correlating >90% with actual cutting results

### User Experience
- [ ] Intuitive material selection interface with search and filtering
- [ ] Real-time parameter updates as material/thickness changes
- [ ] Visual feedback showing parameter confidence and quality predictions
- [ ] Custom material calibration workflow with step-by-step guidance
- [ ] Export functionality for parameter sets and material profiles

### Integration Points
- [ ] Seamless integration with box designer for automatic joint compensation
- [ ] Parameter data flowing to SVG export with embedded cutting settings
- [ ] Material costs integrating with project cost estimation
- [ ] Calibration data syncing with user preferences and project history

## Testing Strategy

### Unit Tests
- Material parameter interpolation algorithms
- Kerf compensation calculations
- Multi-pass optimization logic
- Quality prediction accuracy

### Integration Tests
- Database operations and material profile management
- API endpoint functionality and response validation
- Frontend-backend parameter synchronization
- SVG export with embedded cutting parameters

### Acceptance Tests
- Complete material selection and parameter calculation workflow
- Custom material calibration and validation process
- Integration with box designer and automatic compensation
- Parameter export and import functionality

## Technical Dependencies

### Required Libraries
- **SQLite**: Material database storage and queries
- **NumPy/SciPy**: Mathematical calculations and interpolation
- **Pydantic**: API request/response validation
- **FastAPI**: REST API endpoints

### Integration Dependencies
- **Task 5**: Foundation project setup and database infrastructure
- **Box Designer**: Joint dimension compensation and parameter integration
- **SVG Export**: Embedding cutting parameters in exported files

## Effort Estimate

**Total Effort**: 2-3 days (L-size task)

### Day 1: Database and Core Calculations
- Material database design and population
- Core calculation algorithms implementation
- Basic parameter interpolation functionality

### Day 2: API and Frontend Integration
- REST API endpoints development
- Frontend calculator widget implementation
- Real-time parameter display and updates

### Day 3: Optimization and Testing
- Multi-pass and sequence optimization
- Quality prediction algorithms
- Comprehensive testing and validation

## Risk Factors

### Technical Risks
- **Parameter Accuracy**: Ensuring calculation accuracy without extensive material testing
- **Performance**: Real-time calculations for complex multi-pass scenarios
- **Database Size**: Managing material database growth and query performance

### Mitigation Strategies
- Start with well-documented materials and proven parameter sets
- Implement caching for frequently calculated parameter combinations
- Design database with indexing and query optimization from the start

## Success Metrics

### Performance Targets
- Parameter calculation response time <200ms
- Material database query time <50ms
- Quality prediction accuracy >85% correlation with user feedback

### User Adoption Indicators
- Custom material creation rate >10% of total users
- Parameter override rate <20% (indicating good default recommendations)
- Positive feedback on cutting result accuracy >90%

## Future Enhancements

### Advanced Features (Future Tasks)
- Machine learning-based parameter optimization using user feedback
- Real-time cutting quality monitoring and adaptive parameter adjustment
- Integration with laser cutter firmware for automatic parameter loading
- Community material database with user-contributed profiles and validation
