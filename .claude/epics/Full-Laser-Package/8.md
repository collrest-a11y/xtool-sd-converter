# 8 - Core Box Designer

## Metadata
```yaml
task_id: 8
title: Core Box Designer
epic: Full-Laser-Package
priority: P0
size: L
status: not_started
created: 2025-09-16T03:01:25Z
updated: 2025-09-16T03:13:23Z
parallel: false
depends_on: [5]
estimated_effort: 3 days
```

## Overview
Develop the core parametric box design engine with real-time preview, template system, and SVG export capabilities. This module will serve as the primary tool for creating laser-cuttable box designs with precise measurements and joinery options.

## Objectives
- Create intuitive parametric box designer with real-time preview
- Implement comprehensive template system for common box types
- Develop accurate SVG export with laser-cutting optimizations
- Build flexible measurement and unit conversion system
- Establish foundation for advanced features like custom joints and materials

## Requirements

### Functional Requirements
- **Parametric Design Engine**: Dynamic box generation based on user parameters
- **Real-time Preview**: Live 3D visualization of box design changes
- **Template Library**: Pre-configured templates for common box types
- **Custom Dimensions**: Support for precise length, width, height specifications
- **Material Thickness**: Configurable material thickness with joint compensation
- **Joint Types**: Multiple joinery options (finger joints, tab-and-slot, etc.)
- **SVG Export**: High-quality vector output optimized for laser cutting

### Technical Requirements
- **3D Rendering**: WebGL-based 3D preview using Three.js or similar
- **Vector Graphics**: Precise SVG generation with proper scaling
- **Mathematical Precision**: Accurate calculations for joints and dimensions
- **Template System**: JSON-based template definitions with inheritance
- **Validation Engine**: Input validation with helpful error messages
- **Performance**: Smooth interaction for complex designs
- **Responsive Design**: Works on desktop and tablet devices

### User Experience Requirements
- **Intuitive Interface**: Clear controls with immediate visual feedback
- **Guided Workflow**: Step-by-step process for new users
- **Advanced Mode**: Power user features without cluttering basic interface
- **Undo/Redo**: Full action history with state management
- **Save/Load**: Project persistence with version control
- **Export Options**: Multiple formats and quality settings

## Acceptance Criteria

### Core Design Engine
- [ ] Parametric box generation with configurable dimensions (L×W×H)
- [ ] Material thickness compensation in all calculations
- [ ] Multiple joint types: finger joints, tab-and-slot, box joints
- [ ] Kerf compensation for laser cutting accuracy
- [ ] Auto-generation of cut lines, score lines, and assembly marks
- [ ] Support for metric and imperial units with conversion

### Real-time Preview System
- [ ] Interactive 3D preview using Three.js or WebGL
- [ ] Real-time updates as parameters change (<100ms response)
- [ ] Multiple view angles: isometric, top, front, side
- [ ] Zoom, pan, and rotate controls
- [ ] Visual representation of different cut types (cut, score, mark)
- [ ] Material thickness visualization in 3D view

### Template Library
- [ ] Basic box templates: simple box, hinged box, divider box
- [ ] Advanced templates: display case, jewelry box, organizer
- [ ] Template categorization and search functionality
- [ ] Custom template creation and sharing
- [ ] Template inheritance system for variations
- [ ] Import/export template functionality

### User Interface
- [ ] Clean, intuitive parameter input controls
- [ ] Real-time validation with helpful error messages
- [ ] Responsive design for desktop and tablet
- [ ] Accessibility compliance (keyboard navigation, screen readers)
- [ ] Contextual help and tooltips
- [ ] Progress indicators for long operations

### Export Functionality
- [ ] SVG export with proper scaling and units
- [ ] Optimized cut paths for laser efficiency
- [ ] Layer separation: cuts, scores, marks
- [ ] Multiple output formats: SVG, DXF, PDF
- [ ] Batch export for multiple pieces
- [ ] Export settings: resolution, margins, orientation

### Project Management
- [ ] Save/load projects with full state preservation
- [ ] Project versioning and history
- [ ] Quick save and auto-save functionality
- [ ] Project sharing via URL or file export
- [ ] Recent projects list
- [ ] Project metadata (name, description, tags)

### Validation & Error Handling
- [ ] Input validation for all parameters
- [ ] Geometric validation (impossible dimensions)
- [ ] Material compatibility checking
- [ ] Warning system for potential issues
- [ ] Graceful error recovery
- [ ] Detailed error messages with suggested fixes

## Technical Details

### Box Generation Algorithm
```python
# Core calculation engine
class BoxGenerator:
    def __init__(self, length, width, height, thickness, joint_type):
        self.dimensions = (length, width, height)
        self.thickness = thickness
        self.joint_type = joint_type

    def generate_panels(self):
        # Calculate panel dimensions with joint compensation
        # Generate cut patterns for each panel
        # Apply kerf compensation
        # Return panel definitions

    def calculate_joints(self):
        # Generate finger joint patterns
        # Calculate tab and slot dimensions
        # Ensure proper fit with material thickness
```

### Template System
```json
{
  "id": "basic_box",
  "name": "Basic Box",
  "description": "Simple rectangular box with finger joints",
  "category": "basic",
  "parameters": {
    "length": {"default": 100, "min": 10, "max": 500},
    "width": {"default": 80, "min": 10, "max": 500},
    "height": {"default": 60, "min": 5, "max": 300},
    "thickness": {"default": 3, "min": 1, "max": 20}
  },
  "joint_config": {
    "type": "finger",
    "finger_width": "auto",
    "margin": 5
  }
}
```

### SVG Export Structure
- Organized layers for different operations
- Proper coordinate system and scaling
- Optimized path ordering for cutting efficiency
- Metadata inclusion for traceability

### State Management
- Redux Toolkit or Zustand for complex state
- Immutable state updates for undo/redo
- Persistent state for project saves
- Performance optimization for large designs

## Dependencies
- **Requires**: Task 5 (Project Foundation Setup) must be completed
- **Provides**: Foundation for all subsequent design and processing tasks

## Risks & Mitigation
- **Risk**: Complex 3D rendering performance issues
  - **Mitigation**: Use efficient WebGL libraries, implement level-of-detail optimization
- **Risk**: Mathematical precision errors in joint calculations
  - **Mitigation**: Use decimal.js for precise calculations, extensive unit testing
- **Risk**: SVG export compatibility issues with laser cutters
  - **Mitigation**: Test with multiple laser cutting software, follow industry standards

## Success Metrics
- Users can create basic box in <2 minutes
- Real-time preview updates in <100ms for parameter changes
- SVG exports work correctly with 95% of laser cutting software
- Zero mathematical precision errors in joint calculations
- 95% user satisfaction score for interface usability

## Notes
This core designer will be the heart of the application. Focus on creating a robust, accurate engine that can be extended with advanced features. The template system should be flexible enough to support future complex designs while remaining simple for basic use cases.
